<div class="row">
  <%= form_with url: user_sauna_keyword_search_path, method: :get, local: true do %>
    <div class="col-xs-10">
      <%= text_field_tag :keyword_search, "", placeholder: "サウナキーワード検索", class: "form-control" %>
    </div>
    <div class="col-xs-2">
      <%= button_tag type: "submit", name: nil, class: "btn btn-primary btn-block" do %>
        <i class="fas fa-search">検索</i>
      <% end %>
    </div>
  <% end %>
</div>

<div class="row">
  <div class="col-xs-7">
    <div class="row">
      <h3>
        <i class="fas fa-list-ul">ジャンルから探す
        </i>
      </h3>
    </div>

    <div class="row">
      <h3>
        <i class="fas fa-utensils">サウナ飯から探す</i>　
      </h3>
    </div>

    <div class="row">
      <h3>
        <i class="fas fa-globe-asia">都道府県から探す</i>
      </h3>
    </div>
  </div>

  <div class="col-xs-1">
  </div>

  <div class="col-xs-4">
  <table class="table table-responsive">
    <thead>
      <tr>
        <th class="text-center">順位</th>
        <th class="text-center">サウナ</th>
        <th class="text-center">イキタイ！数</th>
      </tr>
    </thead>
    <tbody>
      <% @saunas_ikitai.each.with_index(1) do |sauna, index| %>
      <tr>
        <td class="text-center"><%= index %></td>
        <td class="text-center"><%= sauna.name %></td>
        <td class="text-center"><%= sauna.ikitais.count %></td>
      </tr>
      <% end %>
    </tbody>
  </table>

  <table class="table table-responsive">
    <thead>
      <tr>
        <th class="text-center">順位</th>
        <th class="text-center">サウナ</th>
        <th class="text-center">PV数</th>
      </tr>
    </thead>
    <tbody>
      <% @saunas_pv.each.with_index(1) do |sauna, index| %>
      <tr>
        <td class="text-center"><%= index %></td>
        <td class="text-center"><%= sauna.name %></td>
        <td class="text-center"><%= sauna.impressions_count %></td>
      </tr>
      <% end %>
    </tbody>
  </table>

  <% @saunas.each do |sauna| %>
    <%= link_to user_sauna_path(sauna) do %>
    <%= sauna.name %>
    <% end %>
  <% end %>
  </div> 
</div>



<div class="row">
  <h3>
      <i class="fas fa-map-marker-alt">現在地から探す</i>
  </h3>
  <div id="map" style="width:1000px; height:600px"></div>

  <script>
    let map
    let marker = [];
    let infoWindow = [];
    let markerData = gon.saunas;

    function initMap() {
      
        if (!navigator.geolocation) {
          alert("Geolocation not supported");
          return;
        }

      // 位置情報を取得
      navigator.geolocation.getCurrentPosition(
        function (position) {
          console.log(position.coords.latitude)
          console.log(position.coords.longitude)
          LatLng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
          // 取得した位置情報を中心に表示
          map = new google.maps.Map(document.getElementById("map"), {
            center: LatLng,
            zoom: 10
          });
          for (var i = 0; i < markerData.length; i++) {
            let id = markerData[i]["id"]

            // 各地点にマーカーを立てる
            markerLatLng = new google.maps.LatLng({
              lat: markerData[i]["latitude"],
              lng: markerData[i]["longitude"]
            });
            marker[i] = new google.maps.Marker({
              position: markerLatLng,
              map: map
            });

            // 各地点の吹き出しを作成
            infoWindow[i] = new google.maps.InfoWindow({
              // 吹き出しに表示する内容
              content: `<a href="/user/saunas/${id}">サウナ詳細を見る</a>` + markerData[i]["name"]
            });

            // マーカーにクリックイベントを追加
            markerEvent(i);
          }
        },
        function() {
          alert("Geolocation failed!");
          return;
        }
      );
    }
    // マーカーをクリックすると吹き出しが表示される
    function markerEvent(i) {
      marker[i].addListener("click", function () {
        infoWindow[i].open(map, marker[i]);
      });
    }
  </script>
  <script
    src="https://maps.googleapis.com/maps/api/js?key=<%= ENV["GOOGLE_MAP_API"] %>&callback=initMap"
    async defer>
  </script>
</div>

